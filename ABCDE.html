<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://unpkg.com/photoswipe@5.4.4/dist/photoswipe.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>

<style>
.split-layout {
  display: flex;
  flex-direction: row;
  width: 100%;
  min-height: 100vh;
}

.split-layout .left-panel {
  width: 26%;
  background-color: #f9f9f9;
  padding: 2rem;
  box-sizing: border-box;
}

.split-layout .right-panel {
  flex: 1;
  padding: 5.8rem 4.5rem;
  box-sizing: border-box;
}

@media screen and (max-width: 1024px) {
  .split-layout {
    flex-direction: column;
  }
  .split-layout .left-panel {
    width: 100%;
    height: auto;
    padding: 2rem 2.5rem;
  }
  .split-layout .right-panel {
    padding: 3.5rem 2rem;
  }
}

.content_padding {
  padding-top: 5.8rem;
  padding-left: 4.5rem;
  padding-right: 4.5rem;
  padding-bottom: 4rem;
}

.page_content {
  margin: 0 auto;
  max-width: 1200px;
}

.image-gallery {
  position: relative;
  display: flex;
  flex-wrap: wrap;
  margin-left: -2rem;
  margin-right: -2rem;
}

.image-gallery [image-gallery-pad] {
  padding-left: 0.7rem;
  padding-right: 0.7rem;
  box-sizing: border-box;
}

.gallery_card {
  margin-bottom: 1.3rem;
  cursor: pointer;
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}

.gallery_card_image {
  position: relative;
  width: 100%;
  overflow: hidden;
}

.gallery_card_image img {
  width: 100%;
  height: auto;
  display: block;
  object-fit: cover;
  transition: opacity 0.6s ease, transform 0.6s ease;
  pointer-events: none;
}

.scroll-transition-fade {
  transition: transform 1s ease-in-out, opacity 0.8s ease-in-out;
}

.scroll-transition-fade.below-viewport {
  opacity: 0;
  transform: translateY(40px);
}

@media (max-width: 768px) {
  .image-gallery [image-gallery-pad] {
    padding: 1.25rem;
  }
}

a.gallery_card {
  text-decoration: none;
  color: inherit;
  outline: none;
}

.pswp__button--zoom,
.pswp__button--close {
  display: none !important;
}

/* 计数器样式，与之前代码一致 */
.pswp__top-bar {
  position: relative !important;
  z-index: 9999 !important;
  padding: 0 !important;
  height: auto !important;
}

.pswp__counter {
  font-family: 'Arial', sans-serif;
  font-size: 18px;
  color: #ff0000;
  background: rgba(0, 0, 0, 0.7);
  padding: 5px 10px;
  border-radius: 3px;
  position: absolute !important;
  top: 10px !important;
  left: 10px !important;
  z-index: 10000 !important;
  margin: 0 !important;
}

@media (max-width: 768px) {
  .pswp__counter {
    font-size: 14px;
    padding: 5px 8px;
  }
}
</style>
</head>

<body>
<div class="split-layout split-responsive">
  <div class="left-panel"></div>
  <div class="right-panel">
    <bodycopy class="bodycopy content content_padding">
      <div class="page_content clearfix" data-elementresizer data-resize-parent data-ce-host="true" data-resize-model-id="37160823">
        <div style="text-align: right;">
          <br><br>
          <span style="color: #f00;">
            <ul>
              <li><i><b><small><span style="color: #f00;"><i>Restorative Topophilia</i></span></small></b></i></li>
              <li><i style="font-size: 1.5rem;"><b><small><span style="color: #f00;"><i>这片土地使我痊愈</i></span></small></b></i></li>
            </ul>
          </span>
        </div>
        <h2>
          <div grid-row grid-pad="4" grid-gutter="8" grid-responsive>
            <div grid-col="6" grid-pad="4" class=""><br></div>
          </div>
        </h2>
        <br><br>
        <div class="image-gallery initialized" image-gallery="justify" image-gallery-row image-gallery-pad="1" image-gallery-gutter="2" id="gallery--test-padding">
          <a href="https://freight.cargo.site/t/original/i/30f222289127d968117b06e14c4ca15a5b5040dbd793dbfce6357c573a15fa3d/Restorative-Topophilia-S-291.jpg"
             data-pswp-width="1600" data-pswp-height="2240" data-title="图片1: Restorative Topophilia"
             class="gallery_card" image-gallery-pad="1" image-gallery-col="" data-gallery-item-id="0" data-width="24.509" data-row="1" style="width: 25.1339%;">
            <div class="gallery_card_image scroll-transition-fade" data-elementresizer-no-resize="" data-elementresizer-no-centering="" style="height: 0px; padding-bottom: 140%; transition-duration: initial;">
              <img data-gallery-item-index="0" data-gallery-uid="147" width="1600" height="2240" src="//freight.cargo.site/w/500/q/75/i/30f222289127d968117b06e14c4ca15a5b5040dbd793dbfce6357c573a15fa3d/Restorative-Topophilia-S-291.jpg" data-mid="225397439" class="image-zoom">
            </div>
          </a>
          <a href="https://freight.cargo.site/t/original/i/d741ff0116bbf9b00fb90c0a622f805a5b7753f5b6c8d0667693106ee41f849e/Restorative-Topophilia-S-75.jpg"
             data-pswp-width="1600" data-pswp-height="2000" data-title="图片2: Healing Land"
             class="gallery_card" image-gallery-pad="1" image-gallery-col="" data-gallery-item-id="1" data-width="27.45" data-row="1" style="width: 27.8667%;">
            <div class="gallery_card_image scroll-transition-fade" data-elementresizer-no-resize="" data-elementresizer-no-centering="" style="height: 0px; padding-bottom: 125%; transition-duration: initial;">
              <img data-gallery-item-index="1" data-gallery-uid="148" width="1600" height="2000" src="//freight.cargo.site/w/600/q/75/i/d741ff0116bbf9b00fb90c0a622f805a5b7753f5b6c8d0667693106ee41f849e/Restorative-Topophilia-S-75.jpg" data-mid="225397396" class="image-zoom">
            </div>
          </a>
          <!-- 省略其余41张图片，需为每张添加 data-title 属性，例如 data-title="图片3: Another Title" -->
        </div>
        <br><br><small></small>
      </div>
    </bodycopy>
  </div>
</div>

<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="pswp__bg"></div>
  <div class="pswp__scroll-wrap">
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    <div class="pswp__ui pswp__ui--hidden">
      <div class="pswp__top-bar">
        <div class="pswp__counter"></div>
      </div>
      <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
      <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>
      <div class="pswp__caption">
        <div class="pswp__caption__center"></div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  if ('addEventListener' in document && FastClick) {
    FastClick.attach(document.body);
  }
  const fadeElements = document.querySelectorAll('.scroll-transition-fade');
  let lastScrollTop = 0;
  const elementLastTriggerPos = new Map();

  function checkScroll() {
    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
    const isScrollingDown = scrollTop > lastScrollTop;
    fadeElements.forEach(element => {
      const rect = element.getBoundingClientRect();
      const elementTop = rect.top;
      const viewportHeight = window.innerHeight;
      const triggerPoint = viewportHeight * 0.8;
      const isVisible = elementTop < triggerPoint && elementTop > 0;
      const lastTriggerPos = elementLastTriggerPos.get(element) || 0;
      if (isScrollingDown && isVisible) {
        if (scrollTop > lastTriggerPos) {
          element.classList.remove('below-viewport');
          elementLastTriggerPos.set(element, scrollTop);
        }
      } else if (!isScrollingDown && !isVisible) {
        if (elementTop > viewportHeight) {
          element.classList.add('below-viewport');
          elementLastTriggerPos.set(element, 0);
        }
      }
    });
    lastScrollTop = scrollTop;
  }

  let scrollTimeout;
  function handleScroll() {
    if (scrollTimeout) {
      clearTimeout(scrollTimeout);
    }
    scrollTimeout = setTimeout(checkScroll, 16);
  }

  window.addEventListener('scroll', handleScroll);
  checkScroll();
});
</script>

<script type="module">
import PhotoSwipeLightbox from 'https://unpkg.com/photoswipe@5.4.4/dist/photoswipe-lightbox.esm.js';

const lightbox = new PhotoSwipeLightbox({
  gallery: '#gallery--test-padding',
  children: 'a',
  pswpModule: () => import('https://unpkg.com/photoswipe@5.4.4/dist/photoswipe.esm.js'),
  padding: { top: 20, bottom: 20, left: 20, right: 20 },
  close: false,
  zoom: false,
  imageClickAction: 'close',
  bgClickAction: 'close',
  clickToCloseNonZoomable: true,
  tapAction: 'close',
  tapToClose: true,
  doubleTapAction: 'zoom',
  showHideAnimationType: 'zoom',
  showAnimationDuration: 333,
  hideAnimationDuration: 333,
  zoomAnimationDuration: 333,
  bgOpacity: 1,
  getViewportSize: function(options) {
    return {
      x: document.documentElement.clientWidth,
      y: document.documentElement.clientHeight
    };
  },
  initialZoomLevel: 'fit',
  secondaryZoomLevel: 2,
  maxZoomLevel: 4,
  minZoomLevel: 0.1,
  pinchToClose: true,
  closeOnVerticalDrag: true
});

// 自定义计数器内容，与之前代码一致
lightbox.on('uiRegister', function() {
  lightbox.pswp.ui.registerElement({
    name: 'custom-counter',
    order: 9,
    isButton: false,
    appendTo: 'bar',
    html: '1/43',
    onInit: (el, pswp) => {
      pswp.on('change', () => {
        const currSlide = pswp.currSlide;
        const totalSlides = pswp.options.dataSource.length;
        const title = currSlide.data.element.dataset.title || `图片 ${pswp.currIndex + 1}`;
        el.innerHTML = `${title} (${pswp.currIndex + 1}/${totalSlides})`;
      });
    }
  });
});

lightbox.on('beforeOpen', () => {
  const isMobile = window.innerWidth <= 768;
  console.log('设备类型:', isMobile ? '移动端' : '桌面端');
});

lightbox.on('bindEvents', () => {
  console.log('PhotoSwipe事件已绑定，单击图片将关闭预览');
});

lightbox.init();
console.log('PhotoSwipe已初始化：单击图片关闭，双击图片缩放');
</script>
</body>
</html>